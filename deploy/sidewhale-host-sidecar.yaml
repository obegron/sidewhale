apiVersion: v1
kind: Namespace
metadata:
  name: sidewhale-sidecar
---
apiVersion: v1
kind: Pod
metadata:
  name: test-runner-with-sidewhale
  namespace: sidewhale-sidecar
spec:
  restartPolicy: Never
  containers:
    - name: sidewhale
      image: sidewhale:dev
      imagePullPolicy: IfNotPresent
      args:
        - --listen
        - :23750
        - --listen-unix
        - /var/run/docker.sock
        - --state-dir
        - /tmp/sidewhale
        - --runtime-backend
        - host
      ports:
        - containerPort: 23750
      securityContext:
        runAsNonRoot: true
        allowPrivilegeEscalation: false
        readOnlyRootFilesystem: true
      volumeMounts:
        - name: docker-sock
          mountPath: /var/run
    - name: tester
      image: maven:3.9.9-eclipse-temurin-21
      command: ["/bin/bash", "-lc", "sleep infinity"]
      env:
        - name: DOCKER_HOST
          value: unix:///var/run/docker.sock
      volumeMounts:
        - name: docker-sock
          mountPath: /var/run
  volumes:
    - name: docker-sock
      emptyDir: {}
